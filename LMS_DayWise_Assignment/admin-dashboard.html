<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Admin Dashboard</a>
            <a class="btn btn-danger" href="logout.html">Logout</a>
        </div>
    </nav>
    <div class="container mt-5">
        <h2 id="welcomeMsg"></h2>
    </div>
    <script>
        const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
        if(currentUser && currentUser.role === 'admin'){
            document.getElementById('welcomeMsg').textContent = `Welcome, ${currentUser.name}!`;
        }else{
            window.location.href = 'login.html';
        }
    </script>
    <div class="container mt-4">
  <h3>Course Management</h3>
  <form id="courseForm">
    <input id="newCourse" class="form-control mb-2" placeholder="New/Edit Course Name" required>
    <button class="btn btn-success">Add Course</button>
  </form>
  <ul id="courseList" class="list-group"></ul>

  <h4 class="mt-4">Show Enrolled Users</h4>
  <select id="courseSelect" class="form-select mb-2"></select>
  <ul id="enrolledUsers" class="list-group"></ul>
</div>

<script>
let adminCourses = JSON.parse(localStorage.getItem('adminCourses')) || [];

// CRUD functions
function renderCourseList(){
    const ul = document.getElementById('courseList');
    ul.innerHTML = '';
    adminCourses.forEach((course, idx) => {
        let li = document.createElement('li');
        li.className = 'list-group-item d-flex justify-content-between align-items-center';
        li.innerHTML = `<span>${course}</span>`;
        let editBtn = document.createElement('button');
        editBtn.textContent = 'Edit';
        editBtn.className = 'btn btn-info btn-sm me-2';
        editBtn.onclick = () => {
            document.getElementById('newCourse').value = course;
            adminCourses.splice(idx, 1);
            localStorage.setItem('adminCourses', JSON.stringify(adminCourses));
            renderCourseList();
            renderCourseSelect();
        };
        let delBtn = document.createElement('button');
        delBtn.textContent = 'Delete';
        delBtn.className = 'btn btn-danger btn-sm';
        delBtn.onclick = () => {
            adminCourses.splice(idx, 1);
            localStorage.setItem('adminCourses', JSON.stringify(adminCourses));
            renderCourseList();
            renderCourseSelect();
        };
        li.appendChild(editBtn);
        li.appendChild(delBtn);
        ul.appendChild(li);
    });
}

document.getElementById('courseForm').onsubmit = (e) => {
    e.preventDefault();
    let course = document.getElementById('newCourse').value.trim();
    if(course){
        adminCourses.push(course);
        localStorage.setItem('adminCourses', JSON.stringify(adminCourses));
        renderCourseList();
        renderCourseSelect();
        document.getElementById('newCourse').value = '';
    }
};

// Show enrolled users for selected course
function renderCourseSelect(){
    const select = document.getElementById('courseSelect');
    select.innerHTML = '';
    adminCourses.forEach(course => {
        let opt = document.createElement('option');
        opt.value = course;
        opt.textContent = course;
        select.appendChild(opt);
    });
}

document.getElementById('courseSelect').onchange = function(){
    let selectedCourse = this.value;
    let enrolled = [];
    let users = JSON.parse(localStorage.getItem('users')) || [];
    users.forEach(user => {
        let cart = JSON.parse(localStorage.getItem('courseCart_' + user.email)) || [];
        if(cart.includes(selectedCourse)){
            enrolled.push(user.name);
        }
    });
    const ul = document.getElementById('enrolledUsers');
    ul.innerHTML = '';
    enrolled.forEach(name => {
        let li = document.createElement('li');
        li.className = 'list-group-item';
        li.textContent = name;
        ul.appendChild(li);
    });
};

renderCourseList();
renderCourseSelect();
</script>

</body>
</html>
